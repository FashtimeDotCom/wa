{% extends "layouts/admin_base.html" %}

{% from "macros/_misc.html" import render_flash_message %}
{% block body %}
<div class="container">
    <div id="tab_li">
    	<ul>
        	<li class="active"><a href="{{ url_for('admin.news_index') }}">文章管理</a></li>
            <a href="{{ url_for('admin.category_index') }}"><li >分类管理</li></a>
        </ul>
    </div>
    <div class="control-group">
        <div class="controls"></div>
    </div>
    <div class="table_tit">编辑文章</div>
    <div id="list_zoom">
    	<div class="table_con active">
        <form method="POST" class="form-horizontal" action="">
            {{ form.csrf_token }}
            <div class="control-group">
                <label class="control-label" for="title">标题</label>
                <div class="controls">
                    <input name="title" type="text" value="{{ news.title }}">
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="category">分类</label>
                <div class="controls">
                    <select name="category_id">
                    {% for cate in cate_list %}
                    	<option value="{{ cate.id }}" {% if cate.id == news.category_id %} selected="selected" {% endif %}>{{ cate.name }}</option>
                    {% endfor %}
                    </select>
                </div>
            </div>
            <div class="control-group check">
                <label class="control-label" for="is_top">是否隐藏</label>
                <div class="controls">
                    {{ form.is_hide }}
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="content">内容</label>
                <div class="controls">
                    <textarea name="content" style="width: 750px; height: 600px;" >{{ news.content }}</textarea>
                </div>
            </div>

            <div class="form-button">
                <button type="submit" class="define_btn">提交</button>
            </div>
        </form>
    	</div>
    </div>
</div>

{% block footerjs %}
<script type="text/javascript" src="{{ url_for('static', filename='editor/kindeditor.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/ajaxupload.js') }}"></script>
<script type="text/javascript">
var editor;
KindEditor.ready(function(K) {
    editor = K.create('textarea', {
        uploadJson: "{{ url_for('admin.upload') }}",
        extraFileUploadParams: {
            "folder": "uploads"
        },
        formatUploadUrl: false,
        allowPreviewEmoticons : false,
        allowImageUpload : true,
        themeType : 'simple',
        'filePostName': 'image',
        items : [
            'fontname', 'fontsize', '|', 'undo', 'redo', '|', 'forecolor', 'hilitecolor', 'bold', 'italic', 'underline',
            'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
            'insertunorderedlist', '|', 'emoticons', 'image', 'link','|', 'preview', 'print', '|', 'source', '|',
            'fullscreen', '|']
    });
});

{#var upload = new AjaxUpload("#unload_new_image",{#}
{#    action:"",#}
{#    name:"image",#}
{#    responseType:"json",#}
{#    data: {'csrf_token':csrf_token, 'folder': 'news'},#}
{#    onSubmit:function(file,ext){#}
{#        if(ext && /^(jpg|jpeg|png|gif)$/.test(ext)){#}
{#            $('#unload_new_image').text("正在上传…");#}
{#            $('#unload_new_image').attr('disabled','disabled');#}
{#        }else{#}
{#            $('#tips').text("*不支持格式！");#}
{#            $('#tips').attr("color","#ff3300");#}
{#            return false;#}
{#        }#}
{#    },#}
{#    onComplete:function(file,response){#}
{#        $('#top_image_url').val(response.image_url);#}
{#        $('#unload_new_image').text("点击更改Logo");#}
{#        $('#unload_new_image').removeAttr("disabled");#}
{#        $('#unload_new_image').removeAttr("color");#}
{#    }#}
{#});#}
</script>
{% endblock %}

{% endblock %}